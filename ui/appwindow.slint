import { Button, VerticalBox, ScrollView, ListView, StandardListView } from "std-widgets.slint";

export component FlatFileTree {
    in property <[string]> files;
}

export enum SolItemType {
    Folder,
    File,
    Script,
    Eml,
}

export struct SolItem {
    name: string,
    item_type: SolItemType,
    active: bool,
    selected: bool,
    index: int,
    path: string,
}

export struct pos {
    x: int,
    y: int,
}

export struct keybinds {
     up: string,
     down: string,
     into: string,
     outof: string,
     find: string,
     quit: string,
     esc: string,
}


export component AppWindow inherits Window {
    in-out property <[StandardListViewItem]> files;
    in-out property <[StandardListViewItem]> child_files_standard;

    in-out property <string> content_of_file;
    in-out property <pos> position;
    in-out property <int> child_pos: child.current-item;
    in-out property <bool> child_focus: child.has-focus;

    in-out property <string> last_path;

    in-out property <string> find_value: find-box.text;
    in-out property <bool> find-box-focus: find-box.has-focus;

    in property <keybinds> keybind;

    callback key_presed(KeyEvent);
    callback find();

    width: 1000px;
    height: 500px;

    background: #2E3440;

    GridLayout {
        forward-focus: global-focus;
        Row {
            Rectangle {
                border-color: find-box-focus ? green : red;
                border-width: 1px;
                height: 20px;
                FocusScope {
                    find-box := TextInput {
                        text: "";
                        edited => {
                            find()
                        }
                    }
                }
            }
        }

        Row {

            Rectangle {
                border-color: parentlist.has-focus ? green : red;
                border-width: 1px;
                width: root.width / 3;
                parentlist := StandardListView {
                    width: parent.width;
                    model: files;
                }
            }

            Rectangle {
                border-color: global-focus.has-focus ? green : red;
                border-width: 1px;
                width: root.width / 3;
                child := StandardListView {
                    width: parent.width;
                    current-item: position.y;
                    model: child_files_standard;
                    forward-focus: global-focus;
                    global-focus := FocusScope {
                        key-pressed(event) => {
                            if (event.text == "f") {
                                find-box.focus();
                                reject
                            } else {
                                key_presed(event);
                                accept
                            }
                        }
                    }
                }
            }
        }

        HorizontalLayout {
            alignment: space-around;
            width: root.width;

            Text {
                text: last_path;
            }

            Text {
                text: "↑: " + keybind.up;
            }

            Text {
                text: " ↓: " + keybind.down;
            }

            Text {
                text: " ←: " + keybind.outof;
            }

            Text {
                text: " →: " + keybind.into;
            }
        Text {
            text: "Filter: " + keybind.find;
        }

        Text {
            text: "Reset Filter: " + keybind.quit;
        }
        }

    }
}
